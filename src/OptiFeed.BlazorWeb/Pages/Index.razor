@page "/"
@using Microsoft.EntityFrameworkCore.Diagnostics
@using OptiFeed.Core.Dtos
@inject IAnimalRepository AnimalRepository
@inject IFeedRepository FeedRepository
@inject IRationRepository RationRepository

<RadzenStack class="rz-p-2 rz-p-md-12" JustifyContent="JustifyContent.SpaceBetween" AlignItems="AlignItems.Center">
    <RadzenCardGroup Responsive="@responsive">
        <RadzenCard Variant="@variant" Style="display: inline-flex;margin-right: 10px">
            <RadzenStack JustifyContent="JustifyContent.SpaceBetween" Gap="10rem">
                <RadzenStack Orientation="Orientation.Horizontal" AlignItems="AlignItems.Start" JustifyContent="JustifyContent.SpaceBetween">
                    <RadzenText TextStyle="TextStyle.H6">Animals</RadzenText>
                    <RadzenText TextStyle="TextStyle.H2" class="rz-m-0">@animalCount</RadzenText>
                </RadzenStack>
            </RadzenStack>
        </RadzenCard>
        <RadzenCard Variant="@variant" Style="display: inline-flex;margin-right: 10px;">
            <RadzenStack JustifyContent="JustifyContent.SpaceBetween" Gap="10rem">
                <RadzenStack Orientation="Orientation.Horizontal" AlignItems="AlignItems.Start" JustifyContent="JustifyContent.SpaceBetween">
                    <RadzenText TextStyle="TextStyle.H6">Feeds</RadzenText>
                    <RadzenText TextStyle="TextStyle.H2" class="rz-m-0">@feedCount</RadzenText>
                </RadzenStack>
            </RadzenStack>
        </RadzenCard>
        <RadzenCard Variant="@variant" Style="display: inline-flex">
            <RadzenStack JustifyContent="JustifyContent.SpaceBetween" Gap="10rem">
                <RadzenStack Orientation="Orientation.Horizontal" AlignItems="AlignItems.Start" JustifyContent="JustifyContent.SpaceBetween">
                    <RadzenText TextStyle="TextStyle.H6">Rations</RadzenText>
                    <RadzenText TextStyle="TextStyle.H2" class="rz-m-0">@rationCount</RadzenText>
                </RadzenStack>
            </RadzenStack>
        </RadzenCard>
    </RadzenCardGroup>
</RadzenStack>

<MDivider></MDivider>


<div class="rz-p-0 rz-p-md-12">
    <MCardTitle Style="justify-content: center">Feed - Stock</MCardTitle>
    <RadzenStack>
        @if (feedAndStock != null)
        {
            <RadzenChart ColorScheme="ColorScheme.Monochrome">
                <RadzenColumnSeries Title="Stock" Data="@feedAndStock" CategoryProperty="FeedName" ValueProperty="Stock"/>
            </RadzenChart>
        }
        else
        {
            <div class="rz-m-12">
                <RadzenProgressBar Value="100" ShowValue="false" Mode="ProgressBarMode.Indeterminate" />
            </div>
        }

    </RadzenStack>
</div>



@code {
    bool responsive = true;

    Variant variant = Variant.Filled;

    int animalCount;
    int feedCount;
    int rationCount;

    private List<FeedAndStockDto> feedAndStock;

    protected override async Task OnInitializedAsync()
    {
        await base.OnInitializedAsync();
        animalCount = await AnimalRepository.GetAnimalCountAsync();
        feedCount = await FeedRepository.GetFeedCountAsync();
        rationCount = await RationRepository.GetRationCountAsync();
        await FeedAndStockChart();
    }

    async Task FeedAndStockChart()
    {
        feedAndStock = await FeedRepository.FeedAndStockChartAsync();
    }
}
